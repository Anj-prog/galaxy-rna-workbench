name: Galaxy RNA-workbench RNA-Seq Introduction Exercise
description: The Galaxy RNA-workbench RNA-Seq tour
title_default: "Galaxy RNA-workbench RNA-Seq Exercise"

steps:

    - title: "<b>Welcome to the Galaxy RNA-worbench!</b>"
      content: "This tour will walk you through an exercise which guides you on how to use the Galaxy RNA-workbench. <br><br>
                Read and Follow the instructions before clicking <b>'Next'</b>.<br><br>
                Click <b>'Prev'</b> in case you missed out on any step"
      backdrop: true
      
    - title: "<b>Scenario</b>"
      content: "In the study of <a href=\"http://genome.cshlp.org/content/21/2/193.long\" target=\"_blank\">Brooks et al. 2011<\a>, the Pasilla (PS) gene, *Drosophila* homologue of the Human splicing regulators Nova-1 and Nova-2 Proteins, was depleted in *Drosophila melanogaster* by RNAi. The authors wanted to identify exons that are regulated by Pasilla gene using RNA sequencing data.

      Total RNA was isolated and used for preparing either single-end or paired-end RNA-seq libraries for treated (PS depleted) samples and untreated samples. These libraries were sequenced to obtain a collection of RNA sequencing reads for each sample. The effects of Pasilla gene depletion on splicing events can then be analyzed by comparison of RNA sequencing data of the treated (PS depleted) and the untreated samples. 
    
      The genome of *Drosophila melanogaster* is known and assembled. It can be used as reference genome to ease this analysis.  In a reference based RNA-seq data analysis, the reads are aligned (or mapped) against a reference genome, *Drosophila melanogaster* here, to significantly improve the ability to reconstruct transcripts and then identify differences of expression between several conditions."
      backdrop: true

    - title: "<b>Goal</b>"
      content: "The goal of this exercise is to <b>become familiar with basic RNA-Seq analysis</b>."
      backdrop: true

    - title: "<b>Disclaimer</b>"
      content: "We are <b>not affiliated</b> with the authors of the paper and we don't make a statement about the relevance or quality of the paper. It is <b>just a fitting example</b> and nothing else.<br>"
      backdrop: true

    - title: "<b>Overview</b>"
      content: "Together we will go through the following:<br>
                <b>Pretreatments, Mapping and Analysis of differential expression</b>
                 <dir>
                   <li>Step 1: Create and name a new history</li> 
                   <li>Step 2: Download data</li>
                   <li>Step 3: Quality control</li>
                   <li>Step 4: Mapping</li>
                   <li>Step 5: Preliminary mapping</li>
                   <li>Step 6: Actual mapping</li>
                   <li>Step 7: Inspection of TopHat results</li>
                   <li>Step 8: IGV</li> 
                   <li>Step 9: Analysis of differential gene expression</li>
                   <li>Step 10: Count the number of reads per annotated gene</li> 
                   <li>Step 11: Analysis of DE</li>
                   <li>Step 12: Visualize DE</li> 
                   <li>Step 12: Visualize DE</li> 
                   <li>Step 13: Analysis of the functional enrichment among differentially expressed genes</li> 
                   <li>Step 14:  Inference of the differential exon usage</li> 
                   <li>Step 14:  Annotation of the result tables with gene information</li> 
                   <li>Step 15: Make a workflow out of this steps</li> 
                   <li>Step 16: Share workflow</li>      
                   <li>Conclusion</li>
                 </dir>"
      backdrop: true

    - title: "<b>Step 1: Create and name a new history</b>"
      element: "#current-history-panel > div.controls > div.title > div"
      intro: "Change the name of your history."
      position: "bottom"

    - title: "<b>Step 2: Download data</b>"
      content: "We will now proceed to download data to Galaxy. The original data is available at NCBI Gene Expression Omnibus (GEO) under accession number <a href=\"http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE18508\" target=\"_blank\">GSE18508</a>. We will look at the 7 first samples: <br>
      - 3 treated samples with Pasilla (PS) gene depletion: <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461179\" target=\"_blank\">GSM461179</a>, <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461180\" target=\"_blank\">GSM461180</a>, <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM4611810\" target=\"_blank\">GSM461181</a><br>
        - 4 untreated samples: <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461176\" target=\"_blank\">GSM461176</a>, <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461177\" target=\"_blank\">GSM461177</a>, <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461178\" target=\"_blank\">GSM461178</a>, <a href=\"https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM461182\" target=\"_blank\">GSM461182</a><br>
          Each sample constitutes a separate biological replicate of the corresponding condition (treated or untreated). Moreover, two of the treated and two of the untreated samples are from a paired-end sequencing assay, while the remaining samples are from a single-end sequencing experiment.<br>
          We have extracted sequences from the Sequence Read Archive (SRA) files to build FASTQ files."
      backdrop: true
            
    - title: "<b>Step 2: Download fastq files with RNA sequences</b>"
      element: ".upload-button"
      intro: "Use the upload button to upload the file to Galaxy.<br><br>
              Click <b>'Next'</b> and the tour will take you to the Upload screen"
      position: "right"
      postclick:
        - ".upload-button"

    - title: "<b>Step 2: Download fastq files with RNA sequences</b>"
      element: "upload-box#upload-text-info"
      intro: "We now paste the links to a fastq dataset pair into the upload-box. Click next to do so. (not working yet, in meantime please copy paste this links to the textbox: <br> 
      https://zenodo.org/record/61771/files/GSM461177_untreat_paired_subset_1.fastq<br>
      https://zenodo.org/record/61771/files/GSM461177_untreat_paired_subset_2.fastq"
     position: "top"
      postclick:
        - "upload-box#upload-text-info"        
        
    - title: "<b>Step 2: Download fasta file with RNA sequence</b>"
      element: "button#btn-start"
      intro: "Now that you've selected the file, select <b>'dm3'</b> as the genome
              and fastqsanger as file format.<br><br>
              Click <b>'Next'</b> and the tour will <b>'Start'</b> the upload.<br>
              Galaxy will automatically unpack the file."
      position: "bottom"
      postclick:
        - "button#btn-start"
        - "button#btn-close"

    - title: "<b>Step 2: Download fasta file with RNA sequence</b>"
      element: "#right"
      intro: "This is your history!<br><br>
              All <b>analysis steps will be recorded</b> and can be redone at any time.<br><br>
              You should be able to see your uploaded file here in a few moments."
      position: "left"

    - title: "<b>Step 3: Quality Control</b>"
      intro: "These files contain the first 100.000 paired-end reads of one sample. The sequences are raw sequences from the sequencing machine, without any pretreatments. They need to be controlled for their quality.<br>
      For quality control, we use similar tools as described in <a href=\"https://www.github.com/bgruening/training-material/NGS-QC\">NGS-QC tutorial<\a>"
      position: "right"

    - title: "<b>Step 3: Quality Control</b>"
      element: '#tool-search-query'
      intro: "
      We now want to examine the quality of our RNA-Seq reads using <b>FastQC</b>.<br><br>
      This Galaxy instance has FastQC already integrated, so we don't need to install them.<br><br>
              <b>Note:</b> You can use 'tool search' to locate tools. Tools may take a couple of moments to load, please bear with us."
      position: "right"

    - title: "<b>Step 3: Quality Control</b>"
      element: '#tool-search-query'
      intro: "You can now type and select <b>'FastQC'</b>.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Select one of the samples from the paired datset.</li>
                <li>Keep the rest of the options at their default values.</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
                <li>Repeat with the other dataset.<\li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 3: Quality Control</b>"
      element: '#current-history-panel'
      intro: "To inspect the results of the FastQC run just<br><br>
              <dir>
                <li>Click on the <b>eye icon</b> of the latest dataset and have a look at the output, what do you see? What is the read length, is there anything you notice when you compare both datasets?</li>
              </dir>"
      position: "left"              

    - title: "<b>Step 3: Quality Control</b>"
      element: '#current-history-panel'
      intro: "You should notice the following:<br><br>
              <dir>
              <li>The read length is 37 bp</li>
              <li>The report for GSM461177_untreat_paired_subset_1 is quite good compared to the one for GSM461177_untreat_paired_subset_2. For the latter, the per base sequence quality is bad around the 25th bp (same for the per base N content), because the quality in the 2nd tile is bad (maybe because of some event during sequencing). We need to process these samples according to this quality control and keep in mind the paired-end information.</li>
              </dir>"
      position: "left"              


    - title: "<b>Step 3: Quality Control</b>"
      element: '#current-history-panel'
      intro: "We now process the samples according to the quality of sequences by running <b>Trim Galore</b> on the paired-end datasets<br><br>
              </dir>"
      position: "left"              

          - title: "<b>Step 3: Quality Control</b>"
      element: '#tool-search-query'
      intro: "You can now type and select <b>'TrimGalore'</b>.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Select the samples from the paired datset and set the sequencing type to paired-end.</li>
                <li>Keep the rest of the options at their default values.</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 3: Quality Control</b>"
      element: '#tool-search-query'
      intro: "You can now type and select <b>'FastQC'</b>.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Select one of the TrimGalore processed samples.</li>
                <li>Keep the rest of the options at their default values.</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
                <li>Repeat with the other dataset.<\li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 3: Quality Control</b>"
      element: '#current-history-panel'
      intro: "To inspect the results of the FastQC run again just<br><br>
              <dir>
                <li>Click on the <b>eye icon</b> of the latest dataset and have a look at the output, what do you see? What is the read length now, is there anything you notice when you compare both datasets now to before the quality processing?</li>
              </dir>"
      position: "left"              
   
    - title: "<b>Step 4: Mapping</b>"
      intro: "Now that we have quality controlled our samples, we want to continue our analysis.<br>
      As the genome of *Drosophila melanogaster* is known and assembled, we can use this information and map the sequences on this genome to identify the effects of Pasilla gene depletion on splicing events.<br>
      To make sense of the reads, their positions within *Drosophila melanogaster* genome must be determined. This process is known as aligning or 'mapping' the reads to the reference genome."
      position: "center"
      
    - title: "<b>Step 4: Mapping</b>"
      intro: "Because in the case of a eukaryotic transcriptome, most reads originate from processed mRNAs lacking exons, they cannot be simply mapped back to the genome as we normally do for DNA data. Instead the reads must be separated into two categories:<br>
      <dir>
      <li>Reads that map entirely within exons<\li>
      <li>Reads that cannot be mapped within an exon across their entire length because they span two or more exons<\li>
      <\dir>"
      position: "center"

    - title: "<b>Step 4: Mapping</b>"
      intro: "Spliced mappers have been developed to efficiently map transcript-derived reads against genomes.<br>
      <a href=\"https://ccb.jhu.edu/software/tophat/index.shtml\">TopHat<\a> was one of the first tools designed specifically to address this problem:<br>
      <dir>
      <li>1. Identification of potential exons using reads that do map to the genome<\li>
      <li>2. Generation of possible splices between neighboring exons<\li>
      <li>3. Comparison of reads that did not initially map to the genome against these *in silico* created junctions<\li>
      <\dir>"
      position: "center"


    - title: "<b>Step 4: Mapping</b>"
      intro: "TopHat needs to know two important parameters about the sequencing library<br>
      <dir>
      <li>The library type<\li>
      <li>The mean inner distance between the mate pairs for paired end data<\li>
      <\dir><br>
      These information should usually come with your FASTQ files, ask your sequencing facility! If not, try to find them on the site where you downloaded the data or in the corresponding publication.<br>
      Another option is to estimate these parameters with a *preliminary mapping* of a *downsampled* file and some analysis programs. Afterward, the actual mapping can be redone on the original files with the optimized parameters.<br>
      To help finding the needed previous information and afterward annotating RNA sequences, we can take advantage from already known reference gene annotations."
      position: "center"     

    - title: "<b>Step 4: Mapping</b>"
      element: ".upload-button"
      intro: "Use the upload button to upload the dm3 reference genome annotation file to Galaxy.<br><br>
              Click <b>'Next'</b> and the tour will take you to the Upload screen"
      position: "right"
      postclick:
        - ".upload-button"

    - title: "<b>Step 4: Mapping</b>"
      element: "upload-box#upload-text-info"
      intro: "We now paste the link to the ENSEMBL gene annotation gtf file into the upload-box. Click next to do so. (not working yet, in meantime please copy paste this links to the textbox: <br> 
      https://zenodo.org/record/61771/files/Drosophila_melanogaster.BDGP5.78.gtf
      "
     position: "top"
      postclick:
        - "upload-box#upload-text-info"        
        
    - title: "<b>Step 4: Mapping</b>"
      element: "button#btn-start"
      intro: "Now that you've selected the file, select <b>'dm3'</b> as the genome
              and gtf as file format.<br><br>
              Click <b>'Next'</b> and the tour will <b>'Start'</b> the upload.<br>
              Galaxy will automatically unpack the file.<br>
              "
      position: "bottom"
      postclick:
        - "button#btn-start"
        - "button#btn-close"
      
    - title: "<b>Step 4: Mapping</b>"
      element: "#tool-search-query"
      intro: "Now we will use TopHat to map out reads to the dm3 genome. You can now type and select <b>'TopHat'</b>.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Paired-end instead of sinlge-end</li>
                <li>'dm3' as reference genome<\li>
                <li>Mean inner distance to 112<\li>
                <li>Library type to<\li>
                <li>Minimum length of read segments to 18<\li>
                <li>Keep the rest of the options at their default values.</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 4: Visualize structure</b>"
      element: '#current-history-panel' 
      intro: "<b>To inspect the output of <b>RNAplot</b>:</b><br>
              <dir>
                <li>Click on the <b>'eye icon'</b> of the corresponding dataset</li>
                <li>Download the file to disk</li>
                <li>untar the file (e.g. with tar -xvf) and view the ps file.</li>
              </dir>"
      position: "left"

    - title: "<b>Step 5: Fold sequence with partition function output</b>"
      element: "#tool-search-query"
      intro: "You can now type and select <b>'RNAfold'</b> again.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Input from FASTA file, same as before</li>
                <li>Sequence to fold: Homo_sapiens_CXCL2_sequence.fa</li>
                <li>Keep the rest of the options at their default values.</li>
                <li><b>BUT</b> this time set the 'Calculate Partition Function' option to 'Yes'</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
              </ol>"      
      position: "right"

    - title: "<b>Step 6: Inspect structure, ensembl MFE and ensembl population</b>"
      element: '#current-history-panel'
      intro: "To inspect the resulting folded sequence as dot-bracket string just<br><br>
              <dir>
                <li>Click on the <b>eye icon</b> of the latest dataset and scroll to the right</li>
                <li>Note the extra lines in the dot-bracket output and the new MFEs at the end</li>
                <li>The first new line shows a condensed representation of the pair probabilities, similar to the bracket notation, followed by the ensemble free energy in kcal/mol. This notation makes use of the letters \" . , | { } ( ) \" denoting bases that are essentially unpaired, weakly paired, strongly paired without preference, weakly upstream (downstream) paired, or strongly up− (down−)stream paired bases, respectively. On the next line the centroid structure as derived from the pair probabilities together with its free energy and distance to the ensemble is shown. The last line shows the frequency of the mfe structure, and the structural diversity (mean distance between the structures in the ensemble).</li>
              </dir>"
      position: "left"              

    - title: "<b>Step 7: Visualize structure</b>"
      element: '#current-history-panel'
      intro: "This time we do not use <b>RNAplot</b> to generate a ps, but we use the extra ouput that is being generated by <b>RNAfold</b>.<br><br>
              <b>Click on the newly generated dataset in rna_eps format:</b><br>
              <ol>
                <li>Click the <b>'eye icon'</b> and open the eps image with your eps viewer of choice.</li>
                <li>Compare the two plots (You should not see any differences).</li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 7: Visualize structure</b>"
      element: '#current-history-panel'
      intro: "In addition to the structure ps file, <b>RNAfold</b> also generates a dotplot. This dotplit shows the pair probabilities within the equilibrium ensemble as n×n matrix, and is an excellent way to visualize structural alternatives. A square at row i and column j indicates a base pair. The area of a square in the upper right half of the matrix is proportional to the probability of the base pair (i,j) within the equilibrium ensemble. The lower left half shows all pairs belonging to the MFE structure. <br><br>
              <b>Click on the second newly generated dataset in rna_eps format:</b><br>
              <ol>
                <li>Click the <b>'eye icon'</b> and open the eps image with your eps viewer of choice.</li>
                <li>Compare the ensembl structure basepairs (upper right) with the MFE structure basepairs (lower left).<br>Do you see that the frequency of the MFE structure in the ensemble is low and the ensemble diversity is high?</li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 8: Use binding sites as constraint for folding</b>"
      content: "Now imagine we have a binding factor of interest that is interacting with our RNA. We are interested in finding out how this is influencing the base-pairing of our mRNA molecule."
      backdrop: true

    - title: "<b>Step 8: Use binding sites as constraint for folding</b>"
      content: "Now download the file containing constraints (the file <b>'Homo_sapiens_CXCL2_constraints.fa'</b>) from <a href=\"http://doi.org/10.5281/zenodo.212693\" target=\"_blank\">zenodo</a> to your computer and then <b>upload</b> the same file to Galaxy as in the beginning of this tour, set the file type to txt."
      backdrop: true

    - title: "<b>Step 8: Use binding sites as constraint for folding</b>"
      element: "#tool-search-query"
      intro: "You can now type and select <b>'RNAfold'</b> again.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Input from FASTA file, same as before</li>
                <li>Sequence to fold: Homo_sapiens_CXCL2_constraints.fa</li>
                <li>Keep the first options at their default values.</li>
                <li>Set the 'Calculate Partition Function' option to 'Yes'</li>
                <li>Click on <b>'Structure constraints'</b></li>
                <li>Select 'Constraints'-'The constraints are in the input fasta file'</b></li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
              </ol>"      
      position: "right"      

    - title: "<b>Step 9: Inspect structure, ensembl MFE and ensembl population of constrained sequence</b>"
      element: '#current-history-panel'
      intro: "To inspect the resulting folded sequence as dot-bracket string just<br><br>
              <dir>
                <li>Click on the <b>eye icon</b> of the latest dataset and scroll to the right</li>
                <li>Note that the constraints led to changes in the predicted MFE structure as well as the ensembl. This can be used to predict the influence of interacting agents on RNA secondary structure. You can also inspect the additional output, similar to the last <b>RNAfold</b> runs.</li>
              </dir>"
      position: "left"              

    - title: "<b>Step 10: Download alignment of gene of interest</b>"
      content: "Now download the file containing a multiple alignment of the gene of interest across 8 primate species (the file <b>'CXCL2_8_primates_EPO.fa'</b>) from <a href=\"http://doi.org/10.5281/zenodo.212693\" target=\"_blank\">zenodo</a> to your computer and then <b>upload</b> the same file to Galaxy as in the beginning of this tour, set the file type to fasta."
      backdrop: true

    - title: "<b>Step 11: Fold alignment and compare consesus structure to single sequence structure</b>"
      element: "#tool-search-query"
      intro: "You can now type and select <b>'RNAalifold'</b> from the tool list.<br><br>
              <b>Follow this set of instructions once the tool was loaded:</b><br>
              <ol>
                <li>Input from FASTA file</li>
                <li>Sequence to fold: CXCL2_8_primates_EPO.fa</li>
                <li>Keep the rest of the options at their default values.</li>
                <li>Click button 'Execute' and wait for the tool to finish.</li>
                <li>Then inspect the consensus structure predicted by <b>RNAalifold</b> and compare it to the <b>RNAfold</b> structures with and without constraints.</li>
              </ol>"      
      position: "right"

    - title: "<b>Step 12: Name  your history</b>"
      element: "#current-history-panel > div.controls > div.title > div"
      intro: "Change the name of your history."
      position: "bottom"

    - title: "<b>Step 13: Make a workflow out of steps 5 to 9</b>"
      element: '#history-options-button'   
      intro: "Please extract your history to a workflow.<br>
              <b>(History options :: Extract workflow)</b><br><br>
              <b>Do not include:</b> 'RNAplot'<br><br>
              Click <b>'Create Workflow'</b>."
      position: "left"      

    - title: "<b>Step 13: Make a workflow out of steps 5 to 9</b>"
      element: '#history-options-button'   
      intro: "To make sure the workflow is correct, check it in the editor and make some small adjustments.<br><br>
              <dir>
                <li>Click on the name of your new workflow and select <b>'Edit'</b></li>
                <li>The individual steps are displayed as boxes, their <b>outputs and inputs are connected through lines</b></li>
                <li>When you click on a box you see the tool options on the right. Besides the tools, you should see two additional boxes titled <b>'Input dataset'</b>. These represent the data we want to feed into our workflow.</li>                       
              </dir>"  
      position: "left"     

    - title: "<b>Step 13: Make a workflow out of steps 5 to 9</b>"
      element: '#history-options-button'   
      intro: "To make sure our workflow is correct, we look at it in the editor and make some small adjustments.<br><br>
              <dir>
                <li>Although we have our two inputs in the workflow they are missing their connection to the first tool <b>(Intersect)</b>, because we didn't carry over the intermediate steps</li>
                <li><b>Connect</b> each input dataset to the Intersect tool by <b>dragging</b> the arrow pointing outwards on the right of its box (which denotes an output) to an arrow on the left of the Intersect box pointing inwards (which denotes an input). Connect each input dataset with a different input of Intersect</li>
                <li>You should also <b>change the names</b> of the input datasets to remember that the first one contains genes and the second one peaks. Don't forget to save it in the end by clicking on <b>'Options'</b> (top right) and selecting <b>'Save'</b></li>                
              </dir>"  
      position: "left"    

    - title: "<b>Step 14: Sharing workflow</b>"
      element: 'a[href$="/workflow/list_for_run"]' 
      intro: "You can share your new workflow.<br>
              <dir>
                <li>Click on your workflow's name and select <b>'Share or publish'</b></li>
                <li>Click <b>'Share with a user'</b></li>
                <li>Enter the email address of the person you wish to share your workflow with.(the same as he/she uses to login to Galaxy)</li>
                <li>Hit <b>'Share'</b></li> 
              </dir>"
      position: "top"

    - title: "<b>Step 14: Sharing workflow</b>"
      element: '#center-panel'   
      intro: "If a workflow has been shared with you, you can find it under <b>'Workflows shared with you by others'</b>:<br>
              <dir>
                <li>Click on a workflow name and select <b>'View'</b></li>
                <li>You can compare the workflows of others with your workflow</li>  
              </dir>"
      position: "right"

    - title: "<b>Enjoy the Galaxy RNA-workbench</b>"
      intro: "Thanks for taking this tour! Happy research with Galaxy!"
